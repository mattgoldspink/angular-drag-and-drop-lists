function detectIE(){var e=window.navigator.userAgent,n=e.indexOf("MSIE ");if(n>0)return parseInt(e.substring(n+5,e.indexOf(".",n)),10);var r=e.indexOf("Trident/");if(r>0){var t=e.indexOf("rv:");return parseInt(e.substring(t+3,e.indexOf(".",t)),10)}var a=e.indexOf("Edge/");return a>0?parseInt(e.substring(a+5,e.indexOf(".",a)),10):!1}angular.module("dndLists",[]).directive("dndDraggable",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(e,n,r,t){return function(a,d,o){d.attr("draggable","true"),o.dndDisableIf&&a.$watch(o.dndDisableIf,function(e){d.attr("draggable",!e)}),d.on("dragstart",function(i){var f=i.originalEvent||i;f.dataTransfer.setData("Text",angular.toJson(a.$eval(o.dndDraggable))),f.dataTransfer.effectAllowed=o.dndEffectAllowed||"move",d.addClass("dndDragging"),n(function(){d.addClass("dndDraggingSource")},0),r.dropEffect="none",t.isDragging=!0,t.dragType=o.dndType?a.$eval(o.dndType):void 0,e(o.dndDragstart)(a,{event:f}),f.stopPropagation()}),d.on("dragend",function(i){var f=i.originalEvent||i,s=r.dropEffect;a.$apply(function(){switch(s){case"move":e(o.dndMoved)(a,{event:f});break;case"copy":e(o.dndCopied)(a,{event:f});break;case"none":e(o.dndCanceled)(a,{event:f})}e(o.dndDragend)(a,{event:f,dropEffect:s})}),d.removeClass("dndDragging"),n(function(){d.removeClass("dndDraggingSource")},0),t.isDragging=!1,f.stopPropagation()}),d.on("click",function(n){if(o.dndSelected){var r=n.originalEvent||n;a.$apply(function(){e(o.dndSelected)(a,{event:r})}),r.stopPropagation()}}),d.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]).directive("dndList",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(e,n,r,t){return function(a,d,o){function i(e){for(var n=e.target.offsetParent,r=0,t=0;n&&!isNaN(n.offsetLeft)&&!isNaN(n.offsetTop);)r+=n.offsetLeft-n.scrollLeft,t+=n.offsetTop-n.scrollTop,n=n.offsetParent;return r=e.clientX-r,t=e.clientY-t,{x:r,y:t}}function f(e,n,r){var t,a,d=0;if(y)t=e.x,a=n.offsetWidth,r&&(d=n.offsetLeft);else{t=e.y;var o=n.getAttribute("data-dnd-height");a=o||n.offsetHeight,r&&(d=n.offsetTop)}return d+a/2>t}function s(){var e;return angular.forEach(d.children(),function(n){var r=angular.element(n);r.hasClass("dndPlaceholder")&&(e=r)}),e||angular.element("<li class='dndPlaceholder'></li>")}function l(){return Array.prototype.indexOf.call(E.children,D)}function g(e){if(!t.isDragging&&!m)return!1;if(!p(e.dataTransfer.types))return!1;if(o.dndAllowedTypes&&t.isDragging){var n=a.$eval(o.dndAllowedTypes);if(angular.isArray(n)&&-1===n.indexOf(t.dragType))return!1}return o.dndDisableIf&&a.$eval(o.dndDisableIf)?!1:!0}function u(){return v.remove(),d.removeClass("dndDragover"),!0}function c(n,r,d,o){return e(n)(a,{event:r,index:d,item:o||void 0,external:!t.isDragging,type:t.isDragging?t.dragType:void 0})}function p(e){if(!e)return!0;for(var n=0;n<e.length;n++)if("Text"===e[n]||"text/plain"===e[n])return!0;return!1}var v=s(),D=v[0],E=d[0],T=detectIE();v.remove();var y=o.dndHorizontalList&&a.$eval(o.dndHorizontalList),m=o.dndExternalSources&&a.$eval(o.dndExternalSources);d.on("dragover",function(e){var n=e.originalEvent||e,r=i(n);if(!g(n))return!0;if(n.target!==E){for(var t=n.target;t.parentNode!==E&&t.parentNode;)t=t.parentNode;t.parentNode===E&&t!==D&&(f(r,t)?E.insertBefore(D,t):E.insertBefore(D,t.nextSibling)),D.parentNode!=E&&d.append(v)}else if(T)if(f(r,D,!0))for(;D.previousElementSibling&&(f(r,D.previousElementSibling,!0)||0===D.previousElementSibling.offsetHeight);)E.insertBefore(D,D.previousElementSibling);else for(;D.nextElementSibling&&!f(r,D.nextElementSibling,!0);)E.insertBefore(D,D.nextElementSibling.nextElementSibling);else D.parentNode!=E&&d.append(v);return o.dndDragover&&!c(o.dndDragover,n,l())?u():(d.addClass("dndDragover"),n.preventDefault(),n.stopPropagation(),!1)}),d.on("drop",function(e){var n=e.originalEvent||e;if(!g(n))return!0;n.preventDefault();var t,d=n.dataTransfer.getData("Text")||n.dataTransfer.getData("text/plain");try{t=JSON.parse(d)}catch(i){return u()}var f=l();if(o.dndDrop&&(t=c(o.dndDrop,n,f,t),!t))return u();var s=a.$eval(o.dndList);return a.$apply(function(){s.splice(f,0,t)}),c(o.dndInserted,n,f,t),"none"===n.dataTransfer.dropEffect?"copy"===n.dataTransfer.effectAllowed||"move"===n.dataTransfer.effectAllowed?r.dropEffect=n.dataTransfer.effectAllowed:r.dropEffect=n.ctrlKey?"copy":"move":r.dropEffect=n.dataTransfer.dropEffect,u(),n.stopPropagation(),!1});var x=null;d.on("dragleave",function(e){d.removeClass("dndDragover"),x&&n.cancel(x),x=n(function(){d.hasClass("dndDragover")||v.remove()},100)})}}]).directive("dndNodrag",function(){return function(e,n,r){n.attr("draggable","true"),n.on("dragstart",function(e){var n=e.originalEvent||e;n.dataTransfer.types&&n.dataTransfer.types.length||n.preventDefault(),n.stopPropagation()}),n.on("dragend",function(e){var n=e.originalEvent||e;n.stopPropagation()})}}).factory("dndDragTypeWorkaround",function(){return{}}).factory("dndDropEffectWorkaround",function(){return{}});